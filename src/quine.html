<!doctype html><meta charset=utf-8><div id=editable contenteditable=true>
<h1>Edit me!</h1>
</div>
Note: this page works best when loaded from <i>your computer</i> in the
<a target=_blank href=http://firefox.com>Firefox</a> browser with the
<a target=_blank href=http://addons.mozilla.org/en-us/firefox/addon/tiddlyfox/>
  TiddlyFox</a> extension.

<script id=versionArea>//Impersonate TiddlyWiki</script><br id=storeArea>

<script>
path = location.href.split("#")[0];
editable = document.getElementById('editable');
re = /^(<!doctype html>\n*<meta charset=utf-8>\n*<div id=editable contenteditable=true>)\n*([\s\S]*)(<\/div>[\s\S]*)/m;

path = /^file\:\/\/\/[A-Z]\:\//i.test(path) ?
    path.substr(8).replace(/\//g,'\\') : path.replace(/^file:(\/)+/, '/');

editable.addEventListener('blur', function() {
  if (loadFile = window.mozillaLoadFile || false) {
    if (contents = loadFile(path)) {
      contents = contents.replace(re, '$1\n' + this.innerHTML.trim() + '\n$3');
      mozillaSaveFile(path, contents);
      delete localStorage['contenteditable'];
      console.log('Saved ' + path);
    } else { console.error('Cannot load ' + path); }
  } else {
    localStorage['contenteditable'] = this.innerHTML;
    console.log("Saved to localStorage['contenteditable']");
  }
});

if (localStorage['contenteditable']) {
  editable.innerHTML = localStorage['contenteditable'];
  console.log("Loaded from localStorage['contenteditable']");
}
</script>
